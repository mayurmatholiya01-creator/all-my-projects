<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tile Search</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <script src="../imagedata.js"></script>
  
  <style>
    :root {
      /* --- NEW THEME MAPPED FROM LANDING PAGE (index (53)) --- */
      --primary: #6366f1; /* from --primary-glow-1 */
      --primary-light: #a855f7; /* from --primary-glow-2 */
      
      --bg-primary: #0a0a0b;
      --glass: rgba(30, 30, 35, 0.6); /* from --card-glass */
      --glass-border: rgba(255, 255, 255, 0.1); /* from --card-border */
      --glass-hover: rgba(35, 35, 40, 0.75); /* from --card-glass-hover */
      
      --text-primary: #f0f6fc;
      --text-secondary: #c9d1d9;
      --text-muted: #8b949e; /* (kept for compatibility) */
      
      --border-radius: 16px; /* from --radius-card */
      --border-radius-sm: 10px; /* (proportional) */
      
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.2);
      
      /* NAV BAR KE LIYE VARIABLES JODE GAYE */
      --safe-area-bottom: env(safe-area-inset-bottom);
      --header-glass: rgba(10, 10, 11, 0.7);
      --card-border: rgba(255, 255, 255, 0.1);
      
      /* [नया] कार्ट के लिए कलर्स */
      --success: #10b981;
      --success-light: #34d399;
      --error: #ef4444;
      --warning: #f59e0b;
    }

    .app-header {
      position: sticky; 
      top: 0;
      width: 100%;
      padding: 15px 20px;
      border-bottom: 1px solid var(--card-border);
      z-index: 100;
      overflow: hidden; 
      transition: transform 0.3s ease-out;
      will-change: transform;
    }
    .app-header.header-hidden { transform: translateY(-100%); }
    .app-header::before {
        content: ''; position: absolute; z-index: -2; top: -100%; left: -100%;
        width: 300%; height: 300%;
        background: conic-gradient(
            from 180deg at 50% 50%,
            var(--primary-glow-1) 0%, var(--primary-glow-2) 33%, 
            var(--primary-glow-3) 66%, var(--primary-glow-1) 100%
        );
        opacity: 0.3;
    }
    .app-header::after {
        content: ''; position: absolute; z-index: -1; inset: 0; 
        background: var(--header-glass); 
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    }
    .header-content {
      max-width: 1200px; margin: 0 auto; display: flex;
      justify-content: space-between; align-items: center; font-weight: 600;
    }
    .logo-container { display: flex; align-items: center; gap: 10px; }
    .logo-container img { height: 35px; width: auto; object-fit: contain; }
    .header-icon-btn { background: transparent; border: none; cursor: pointer; padding: 5px; line-height: 0; }
    .header-icon-btn svg { width: 20px; height: 20px; stroke: var(--text-secondary); transition: all 0.3s ease; }
    .header-icon-btn:hover svg { stroke: var(--text-primary); transform: rotate(90deg); }
  
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',Roboto,sans-serif;
      background: var(--bg-primary); 
      color: var(--text-primary); 
      padding:20px; min-height:100vh;
      line-height:1.6; 
      background-image: radial-gradient(at 50% 0%, hsla(228,100%,74%,0.1) 0, transparent 50%);
      padding-top: max(20px, env(safe-area-inset-top));
      padding-bottom: calc(65px + max(20px, env(safe-area-inset-bottom)));
      padding-left: max(20px, env(safe-area-inset-left));
      padding-right: max(20px, env(safe-area-inset-right));
    }
    
    body.modal-open .app-container { 
      filter:blur(4px) brightness(0.7); 
      transition:filter 0.3s ease;
    }
    body.modal-open .app-header {
      filter:blur(4px) brightness(0.7); 
      transition:filter 0.3s ease;
    }
    
    .app-container { 
      max-width:1200px; margin:0 auto;
      animation:fadeIn 0.6s ease-out;
    }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:none} }

    .controls {
      display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:32px;
      padding:24px; 
      background: var(--glass); 
      border-radius: var(--border-radius); 
      border: 1px solid var(--glass-border);
    }
    .control-group { position:relative; }
    .control-label {
      display:block; color: var(--text-secondary); font-size:14px; font-weight:600;
      margin-bottom:8px; text-transform:uppercase; letter-spacing:0.5px;
    }
    .control-input {
      width:100%; padding:14px 20px; 
      background: var(--glass);
      border: 1px solid var(--glass-border); 
      border-radius: var(--border-radius-sm); 
      color: var(--text-primary);
      font-size:16px; outline:none; transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
    }
    .control-input:focus { 
      border-color: var(--primary); 
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
      background: var(--glass-hover); 
    }
    .dropdown {
      appearance:none; cursor:pointer; padding-right:50px;
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%238b949e' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-repeat:no-repeat; background-position:right 16px center; background-size:16px;
    }

    .search-suggestions {
      position:absolute; top:100%; left:0; right:0; z-index:1000;
      background: var(--glass-hover); 
      border: 1px solid var(--glass-border); 
      border-radius: var(--border-radius-sm);
      max-height:300px; overflow-y:auto; display:none; margin-top:4px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      backdrop-filter: blur(5px);
    }
    .suggestion-item {
      padding:12px 20px; cursor:pointer; color: var(--text-primary);
      border-bottom: 1px solid var(--glass-border); 
      transition:all 0.2s;
    }
    .suggestion-item:hover { 
      background: var(--glass-hover); 
      color: var(--primary-light); 
    }
    .suggestion-item:last-child { border:none; }

    .tiles-grid { 
      display:grid; grid-template-columns:repeat(auto-fill,minmax(400px,1fr)); 
      gap:20px; margin-bottom:32px;
    }
    .tile-card {
      background: var(--glass); 
      border: 1px solid var(--glass-border); 
      border-radius: var(--border-radius);
      overflow:hidden; transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      cursor:pointer; position:relative;
    }
    .tile-card:hover { 
      transform:translateY(-4px); 
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
      background: var(--glass-hover);
    }
    
    .tile-image {
      width:100%; height:280px; position:relative; overflow:hidden;
      background:linear-gradient(45deg, var(--glass), var(--bg-primary));
    }
    .tile-image img {
      width:100%; height:100%; object-fit:cover; 
      transition:transform 0.5s cubic-bezier(0.4,0,0.2,1);
    }
    .tile-card:hover .tile-image img { transform:scale(1.05); }
    
    .tile-content {
      padding:16px 20px; display:flex; justify-content:space-between; align-items:center;
    }
    .tile-info {
      flex:1; min-width:0;
    }
    .tile-info h3 {
      font-size:1rem; font-weight:600; color: var(--text-primary); margin-bottom:2px;
      line-height:1.3; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .tile-info p { color: var(--text-secondary); font-size:0.85rem; }
    
    .tile-actions {
      display:flex; gap:8px; flex-shrink:0; margin-left:12px;
    }
    
    .action-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    .action-btn:hover {
      transform: translateY(-2px) scale(1.05);
    }
    .action-btn:active {
      transform: translateY(0) scale(1);
    }
    
    .download-btn {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3e%3cpath d='M12 16l-5-5h3V4h4v7h3l-5 5z'/%3e%3cpath d='M5 20h14v2H5v-2z'/%3e%3c/svg%3e");
      background-size:18px; background-repeat:no-repeat; background-position:center;
    }
    .whatsapp-btn {
      background: linear-gradient(135deg, #25D366, #128C7E);
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3e%3cpath d='M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488'/%3e%3c/svg%3e");
      background-size:18px; background-repeat:no-repeat; background-position:center;
    }

    /* Modal buttons */
    .modal-action-btn {
      width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.2s ease; position: relative; overflow: hidden;
      box-shadow: var(--shadow);
    }
    .modal-action-btn:hover { transform: translateY(-2px) scale(1.05); }
    .modal-action-btn:active { transform: translateY(0) scale(1); }
    .modal-download-btn {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3e%3cpath d='M12 16l-5-5h3V4h4v7h3l-5 5z'/%3e%3cpath d='M5 20h14v2H5v-2z'/%3e%3c/svg%3e");
      background-size:18px; background-repeat:no-repeat; background-position:center;
    }
    .modal-whatsapp-btn {
      background: linear-gradient(135deg, #25D366, #128C7E);
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3e%3cpath d='M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488'/%3e%3c/svg%3e");
      background-size:18px; background-repeat:no-repeat; background-position:center;
    }

    .load-more {
      display:block; margin:0 auto; padding:16px 32px;
      background:linear-gradient(135deg, var(--primary), var(--primary-light));
      border:none; border-radius: var(--border-radius-sm); color:#fff; font-size:16px; font-weight:600;
      cursor:pointer; transition:all 0.3s; text-transform:uppercase; letter-spacing:0.5px;
    }
    .load-more:hover { transform:translateY(-2px); box-shadow:0 10px 30px rgba(99, 102, 241, 0.3); }
    .load-more:disabled { opacity:0.6; cursor:not-allowed; transform:none; }

    .modal-overlay {
      position:fixed; top:0; left:0; right:0; bottom:0; z-index:2000;
      background:rgba(0,0,0,0.8); 
      display:none; align-items:center; justify-content:center; padding:20px;
      backdrop-filter:blur(8px);
    }
    
    .modal-content {
      background: var(--glass); 
      border-radius: var(--border-radius); 
      max-width:90vw; max-height:90vh;
      border: 1px solid var(--glass-border); 
      position:relative; overflow:hidden;
      animation:modalIn 0.4s cubic-bezier(0.34,1.56,0.64,1);
      box-shadow: 0 40px 80px rgba(0,0,0,0.6);
      filter:none !important;
    }
    @keyframes modalIn { 
      from{opacity:0;transform:scale(0.8) translateY(40px)} 
      to{opacity:1;transform:scale(1) translateY(0)} 
    }
    
    .modal-header {
      position:absolute; top:0; left:0; right:0; z-index:10;
      background: rgba(30, 30, 35, 0.75);
      backdrop-filter:blur(12px);
      padding:12px 20px; 
      border-bottom: 1px solid var(--glass-border);
      display:flex; justify-content:space-between; align-items:center;
    }
    
    .modal-caption {
      text-align:center; flex:1;
      font-size:0.95rem; font-weight:500; color: var(--text-primary);
      opacity:0.9;
    }
    
    .modal-controls {
      display:flex; gap:8px; align-items:center;
    }
    
    .close-btn {
      width:28px; height:28px; border:none; 
      background: var(--glass);
      color: var(--text-muted);
      border-radius: var(--border-radius-sm); 
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      transition:all 0.2s; font-size:16px; 
    }
    .close-btn:hover { 
      background: var(--glass-hover); 
      color: var(--text-primary); 
    }
    
    .modal-image {
      max-width:800px; max-height:600px; width:100%; height:auto;
      display:block; margin:0 auto; margin-top:52px;
      filter:none !important;
    }

    .empty-state {
      text-align:center; padding:80px 20px; color: var(--text-muted);
    }
    .empty-state h3 { font-size:1.5rem; margin-bottom:12px; color: var(--text-primary); }

    /* PWA Install Prompt */
    .install-prompt {
      position:fixed; bottom:20px; left:20px; right:20px; z-index:1500;
      background: var(--glass); 
      border: 1px solid var(--glass-border); 
      border-radius: var(--border-radius);
      padding:16px; display:none; animation:slideUp 0.3s ease;
      backdrop-filter: blur(5px);
    }
    .install-prompt.show { display:flex; }
    .install-prompt-content { flex:1; margin-right:16px; }
    .install-prompt h3 { font-size:0.9rem; color: var(--text-primary); margin-bottom:4px; }
    .install-prompt p { font-size:0.8rem; color: var(--text-secondary); }
    .install-btn {
      background: linear-gradient(135deg, var(--primary), var(--primary-light)); 
      color: var(--text-primary); 
      border:none; border-radius: var(--border-radius-sm);
      padding:8px 16px; font-size:0.85rem; font-weight:600; cursor:pointer;
    }
    .install-dismiss {
      background:transparent; color: var(--text-muted); border:none;
      padding:8px; margin-left:8px; cursor:pointer;
    }
    @keyframes slideUp {
      from { transform:translateY(100%); opacity:0; }
      to { transform:translateY(0); opacity:1; }
    }

    @media(max-width:768px){
      .controls { grid-template-columns:1fr; }
      .tiles-grid { grid-template-columns:1fr; }
      .modal-caption { font-size:0.85rem; }
      .modal-controls { gap:6px; }
      .app-container { padding:16px; }
      .action-btn { width:32px; height:32px; }
      .modal-action-btn { width:32px; height:32px; }
      body { 
        padding:16px; 
        padding-top: max(16px, env(safe-area-inset-top)); 
        padding-bottom: calc(65px + max(16px, env(safe-area-inset-bottom)));
      }
      .install-prompt { left:16px; right:16px; bottom:16px; }
    }
    
    /* --- Bottom Navigation Bar Styles --- */
    .bottom-nav {
        position: fixed; bottom: 0; left: 0; right: 0;
        height: calc(65px + var(--safe-area-bottom)); 
        background: var(--header-glass); 
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border-top: 1px solid var(--card-border);
        display: flex; z-index: 1000;
        padding-bottom: var(--safe-area-bottom);
    }
    .nav-link {
        flex: 1; display: flex; flex-direction: column;
        align-items: center; justify-content: center;
        text-decoration: none; color: var(--text-secondary); 
        font-size: 10px; font-weight: 500;
        position: relative; transition: color 0.2s ease, transform 0.1s ease;
        -webkit-tap-highlight-color: transparent;
    }
    .nav-link:active { transform: scale(0.96); }
    .nav-icon { font-size: 22px; margin-bottom: 4px; }
    .nav-link.active { color: var(--primary); }
    .nav-link.active::before {
        content: ''; position: absolute; top: 2px; left: 50%;
        transform: translateX(-50%); width: 30px; height: 3px;
        background: linear-gradient(135deg, var(--primary), var(--primary-light));
        border-radius: 0 0 3px 3px;
    }
    /* --- END OF NAV BAR STYLES --- */
    
    /* === [बदलाव 1] CART STYLES === */
    
    /* कार्ड पर नया सलेक्ट बटन (हल्का) */
    .select-btn {
      background: var(--glass-hover); /* हल्का बैकग्राउंड */
    }
    .select-btn .fas {
      color: var(--primary); /* सिर्फ आइकन को प्राइमरी कलर दिया */
      font-size: 16px;
      transition: transform 0.2s ease;
    }
    
    /* सलेक्टेड स्टेट (हरा) */
    .select-btn.selected {
      background: linear-gradient(135deg, var(--success), var(--success-light)); /* Green */
    }
    .select-btn.selected .fas {
      color: white; /* आइकन को सफेद करें */
      transform: scale(1.1);
    }
    
    /* कार्ड की सलेक्टेड स्टेट */
    .tile-card.selected {
      border-color: var(--primary);
      box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
    }
    
    /* फ्लोटिंग कार्ट बटन (FAB) */
    .cart-fab {
      position: fixed;
      bottom: calc(85px + var(--safe-area-bottom)); 
      right: max(20px, env(safe-area-inset-right));
      z-index: 1001;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white; border: none; border-radius: 50%;
      width: 60px; height: 60px;
      display: none; align-items: center; justify-content: center;
      cursor: pointer; box-shadow: var(--shadow-lg);
      transform: scale(0);
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .cart-fab.show {
      display: flex;
      transform: scale(1);
    }
    .cart-fab:hover { transform: scale(1.1); }
    .cart-fab .fas { font-size: 20px; }
    #cart-count {
      position: absolute; top: -5px; right: -5px;
      background: var(--error); color: white;
      border-radius: 50%; width: 24px; height: 24px;
      font-size: 12px; font-weight: 600;
      display: flex; align-items: center; justify-content: center;
      border: 2px solid var(--bg-primary);
    }

    /* [बदलाव 2] कार्ट Modal के अंदर का कंटेंट (बटन से जुड़ा हुआ) */
    #cartModalOverlay {
      /* केंद्र के बजाय अब कोने में अलाइन होगा */
      align-items: flex-end;
      justify-content: flex-end;
      padding: 20px;
      /* FAB और Nav Bar के लिए जगह */
      padding-bottom: calc(160px + var(--safe-area-bottom)); 
      padding-right: max(20px, env(safe-area-inset-right));
    }
    
    #cartModalOverlay .modal-content {
      /* मूल Modal से एनीमेशन हटाया */
      animation: none; 
      /* नया एनीमेशन और पोजीशन */
      max-width: 400px;
      max-height: 70vh;
      transform-origin: bottom right; /* यह जादू है! */
      animation: cartModalIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    /* छिपने का एनीमेशन */
    #cartModalOverlay.closing .modal-content {
      animation: cartModalOut 0.3s ease-out forwards;
    }
    
    @keyframes cartModalIn { 
      from{opacity:0;transform:scale(0.1)} 
      to{opacity:1;transform:scale(1)} 
    }
    @keyframes cartModalOut {
      from { opacity: 1; transform: scale(1); }
      to { opacity: 0; transform: scale(0.1); }
    }
    
    #cart-modal-content {
      padding: 20px;
      padding-top: 80px; /* हेडर की जगह */
      max-height: 70vh;
      overflow-y: auto;
    }
    .cart-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    .cart-item { position: relative; }
    .cart-item img {
      width: 100%; height: 100px; object-fit: cover;
      border-radius: var(--border-radius-sm);
    }
    .cart-item-remove {
      position: absolute; top: -5px; right: -5px;
      background: var(--error); color: white; border: none;
      border-radius: 50%; width: 20px; height: 20px;
      cursor: pointer; font-size: 12px; line-height: 20px; text-align: center;
    }
    .cart-modal-actions { display: flex; gap: 10px; }
    .cart-action-btn {
      flex: 1; padding: 12px; border: none;
      border-radius: var(--border-radius-sm);
      color: white; font-size: 1em; font-weight: 600;
      cursor: pointer; transition: all 0.3s ease;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .cart-action-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .cart-action-download { background: linear-gradient(135deg, var(--primary), var(--primary-light)); }
    .cart-action-share { background: linear-gradient(135deg, var(--success), var(--success-light)); }
    .cart-action-clear { background: linear-gradient(135deg, var(--warning), #f97316); }
    
    /* [बदलाव 3] Fly-to-Cart एनीमेशन के लिए CSS */
    .fly-to-cart-clone {
      position: fixed;
      z-index: 3000; /* सबसे ऊपर */
      border-radius: var(--border-radius-sm);
      transition: all 0.6s cubic-bezier(0.5, -0.5, 0.8, 0.5); /* macOS जैसा ईज़िंग */
      pointer-events: none;
    }
    /* === [नया] END CART STYLES === */
  </style>
</head>
<body>
  <header class="app-header">
    <div class="header-content">
        <div class="logo-container">
            <img id="logoA" alt="Logo A">
            <img id="logoGranicer2" alt="Granicer Logo 2"> </div>

        <button id="refresh-btn" class="header-icon-btn" title="Refresh Page">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 4v6h-6M1 20v-6h6"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
            </svg>
        </button>
    </div>
</header>
  <div class="app-container">
    <div class="controls">
      <div class="control-group">
        <label class="control-label">Filter by Size</label>
        <select id="sizeFilter" class="control-input dropdown">
          <option value="">All Sizes</option>
        </select>
      </div>
      <div class="control-group">
        <label class="control-label">Search Designs</label>
        <input id="searchInput" class="control-input" type="text" 
               placeholder="Type design name..." autocomplete="off" />
        <div id="searchSuggestions" class="search-suggestions"></div>
      </div>
    </div>

    <div id="tilesGrid" class="tiles-grid"></div>
    
    <button id="loadMoreBtn" class="load-more" style="display:none">
      Load More Designs
    </button>

    <div class="empty-state" id="emptyState" style="display:none">
      <h3>No tiles found</h3>
      <p>Try adjusting your search or filter criteria</p>
    </div>
  </div>

  <div class="install-prompt" id="installPrompt">
    <div class="install-prompt-content">
      <h3>Install Tile Search</h3>
      <p>Add to home screen for full screen experience</p>
    </div>
    <button class="install-btn" id="installBtn">Install</button>
    <button class="install-dismiss" id="installDismiss">✕</button>
  </div>

  <div id="modalOverlay" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-caption" id="modalCaption"></div>
        <div class="modal-controls">
          <button class="modal-action-btn modal-download-btn" id="modalDownload" title="Download"></button>
          <button class="modal-action-btn modal-whatsapp-btn" id="modalWhatsapp" title="Share on WhatsApp"></button>
          <button class="close-btn" onclick="closeModal()">✕</button>
        </div>
      </div>
      <img id="modalImage" class="modal-image" alt="" />
    </div>
  </div>

  <div id="cart-fab" class="cart-fab" onclick="openCartModal()">
    <i class="fas fa-shopping-cart"></i>
    <span id="cart-count">0</span>
  </div>

  <div id="cartModalOverlay" class="modal-overlay">
    <div class="modal-content" id="cart-modal-content">
      </div>
  </div>
  <script>
    // --- Naya Header JS ---
    window.addEventListener('DOMContentLoaded', () => {
        try {
            if (typeof logoA_base64 !== 'undefined') {
                document.getElementById('logoA').src = logoA_base64;
            }
            if (typeof logoGranicer2_base64 !== 'undefined') {
                document.getElementById('logoGranicer2').src = logoGranicer2_base64;
            }
        } catch (e) {
            console.error("Logo base64 data nahi mila. imagedata.js loaded hai?", e);
        }

        document.getElementById('refresh-btn').addEventListener('click', () => {
            location.reload();
        });

        const header = document.querySelector('.app-header');
        if (header) {
            let lastScrollY = window.scrollY;

            window.addEventListener('scroll', () => {
                const currentScrollY = window.scrollY;

                if (currentScrollY > lastScrollY && currentScrollY > 50) {
                    header.classList.add('header-hidden');
                } else {
                    header.classList.remove('header-hidden');
                }

                lastScrollY = currentScrollY;
            }, { passive: true });
        }
        loadApp();
    }); 
    // --- End Naya Header JS ---

    // --- मूल app ऑब्जेक्ट ---
    const app = {
      data: [],
      filteredData: [],
      displayedCount: 5,
      loadIncrement: 10,
      
      elements: {
        sizeFilter: document.getElementById('sizeFilter'),
        searchInput: document.getElementById('searchInput'),
        suggestions: document.getElementById('searchSuggestions'),
        tilesGrid: document.getElementById('tilesGrid'),
        loadMoreBtn: document.getElementById('loadMoreBtn'),
        emptyState: document.getElementById('emptyState'),
        modal: document.getElementById('modalOverlay'),
        modalCaption: document.getElementById('modalCaption'),
        modalImage: document.getElementById('modalImage'),
        modalDownload: document.getElementById('modalDownload'),
        modalWhatsapp: document.getElementById('modalWhatsapp')
      }
    };
    
    // --- [बदलाव 4] CART LOGIC ---
    let cart = []; 
    
    function updateCartButton() {
      const fab = document.getElementById('cart-fab');
      const count = document.getElementById('cart-count');
      
      if (cart.length > 0) {
        fab.classList.add('show');
        count.textContent = cart.length;
      } else {
        fab.classList.remove('show');
      }
    }
    
    // [बदलाव 5] macOS जैसा Fly-to-Cart एनीमेशन
    // [बदलाव] macOS जैसा Fly-to-Cart एनीमेशन
    function flyToCart(event) {
        try {
            const card = event.target.closest('.tile-card');
            const img = card.querySelector('.tile-image img');
            if (!img) return;

            const fab = document.getElementById('cart-fab');
            if (!fab) return; // कार्ट बटन नहीं मिला
            
            const fabRect = fab.getBoundingClientRect();
            const imgRect = img.getBoundingClientRect();
            
            // 1. क्लोन बनाएं
            const clone = img.cloneNode(true);
            clone.classList.add('fly-to-cart-clone'); // CSS transition इसी क्लास में है
            
            // 2. क्लोन को स्टाइल करें (शुरुआती पोजीशन)
            clone.style.top = `${imgRect.top}px`;
            clone.style.left = `${imgRect.left}px`;
            clone.style.width = `${imgRect.width}px`;
            clone.style.height = `${imgRect.height}px`;
            clone.style.opacity = '0.8';
            
            document.body.appendChild(clone);

            // 3. [नया] एनीमेशन को विश्वसनीय रूप से शुरू करें
            // ब्राउज़र को क्लोन को "पेंट" करने के लिए एक पल दें
            setTimeout(() => {
                clone.style.top = `${fabRect.top + fabRect.height / 2 - 10}px`; // बटन के केंद्र में
                clone.style.left = `${fabRect.left + fabRect.width / 2 - 10}px`; // बटन के केंद्र में
                clone.style.width = '20px'; // छोटा करें
                clone.style.height = '20px'; // छोटा करें
                clone.style.opacity = '0';
                clone.style.transform = 'scale(0.1)';
            }, 10); // 10ms का छोटा सा डिले

            // 4. क्लोन को हटा दें
            setTimeout(() => {
                if (clone.parentNode) {
                    clone.parentNode.removeChild(clone);
                }
            }, 610); // 600ms (एनीमेशन) + 10ms (डिले)

        } catch (err) {
            console.warn('Fly-to-cart animation failed:', err);
        }
    }

    function toggleSelection(event, designName) {
      event.stopPropagation();
      
      const tile = app.data.find(t => t.design_name === designName);
      if (!tile) return;

      const card = event.target.closest('.tile-card');
      const button = event.target.closest('.select-btn');

      const indexInCart = cart.findIndex(item => item.design_name === designName);

      if (indexInCart > -1) {
        cart.splice(indexInCart, 1);
        button.innerHTML = '<i class="fas fa-plus"></i>';
        button.classList.remove('selected');
        card.classList.remove('selected');
      } else {
        cart.push(tile);
        button.innerHTML = '<i class="fas fa-check"></i>';
        button.classList.add('selected');
        card.classList.add('selected');
        flyToCart(event); // [बदलाव 6] एनीमेशन को कॉल करें
      }
      
      updateCartButton();
    }

    function openCartModal() {
      const modal = document.getElementById('cartModalOverlay');
      const content = document.getElementById('cart-modal-content');
      
      let gridHTML = '';
      cart.forEach(tile => {
        gridHTML += `
          <div class="cart-item">
            <img src="${getImageUrl(tile.url)}" alt="${tile.design_name}" />
            <button class="cart-item-remove" onclick="removeCartItem('${tile.design_name}')">✕</button>
          </div>
        `;
      });

      content.innerHTML = `
        <div class="modal-header">
          <div class="modal-caption">Selected Items (${cart.length})</div>
          <button class="close-btn" onclick="closeCartModal()">✕</button>
        </div>
        <div class="cart-grid">
          ${gridHTML}
        </div>
        <div class="cart-modal-actions">
          <button class="cart-action-btn cart-action-download" onclick="downloadAllSelected()">
            <i class="fas fa-download"></i> Download All
          </button>
          <button class="cart-action-btn cart-action-share" onclick="shareAllSelected()">
            <i class="fab fa-whatsapp"></i> Share All
          </button>
          <button class="cart-action-btn cart-action-clear" onclick="clearCart()">
            <i class="fas fa-trash"></i> Clear All
          </button>
        </div>
      `;
      
      modal.style.display = 'flex';
      document.body.classList.add('modal-open');
    }

    // [बदलाव 7] क्लोज़ Modal एनीमेशन के साथ
    function closeCartModal() {
      const modal = document.getElementById('cartModalOverlay');
      modal.classList.add('closing');
      document.body.classList.remove('modal-open');
      
      setTimeout(() => {
        modal.style.display = 'none';
        modal.classList.remove('closing');
      }, 300); // 300ms (एनीमेशन टाइम)
    }

    function removeCartItem(designName) {
      const indexInCart = cart.findIndex(item => item.design_name === designName);
      if (indexInCart > -1) {
        cart.splice(indexInCart, 1);
      }
      
      const card = Array.from(document.querySelectorAll('.tile-card')).find(c => c.innerHTML.includes(`'${designName}'`));
      if (card) {
        const button = card.querySelector('.select-btn');
        button.innerHTML = '<i class="fas fa-plus"></i>';
        button.classList.remove('selected');
        card.classList.remove('selected');
      }
      
      updateCartButton();
      if (cart.length > 0) {
        openCartModal(); 
      } else {
        closeCartModal(); 
      }
    }

    function clearCart() {
      cart = []; 
      
      document.querySelectorAll('.tile-card.selected').forEach(card => {
        card.classList.remove('selected');
        const button = card.querySelector('.select-btn');
        if (button) {
          button.innerHTML = '<i class="fas fa-plus"></i>';
          button.classList.remove('selected');
        }
      });
      
      updateCartButton();
      closeCartModal();
    }

    function downloadAllSelected() {
      if (cart.length === 0) return;
      
      alert(`Preparing to download ${cart.length} images.\n\nNOTE: Your browser might ask for permission to open multiple pop-ups. Please "Allow" it.`);
      
      cart.forEach((tile, index) => {
        const downloadUrl = getDownloadUrl(tile.url);
        setTimeout(() => {
          window.open(downloadUrl, '_blank');
        }, index * 300);
      });
    }

    // [बदलाव 8] शेयर लॉजिक (बिना टेक्स्ट के)
    async function shareAllSelected() {
      if (cart.length === 0) return;

      // 1. पहले टेक्स्ट फॉलबैक तैयार करें
      let textFallback = 'Check out these tile designs:\n\n';
      cart.forEach((tile, index) => {
        textFallback += `${index + 1}. ${tile.design_name} (${tile.dimensions})\n${getDownloadUrl(tile.url)}\n\n`;
      });

      // 2. असली फ़ाइलें शेयर करने की कोशिश करें
      try {
        const shareBtn = document.querySelector('.cart-action-share');
        shareBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sharing...';
        shareBtn.disabled = true;

        const files = await Promise.all(cart.map(async (tile) => {
          const response = await fetch(getFullImageUrl(tile.url)); 
          const blob = await response.blob();
          return new File([blob], `${tile.design_name}.jpg`, { type: 'image/jpeg' });
        }));

        // 3. चेक करें कि क्या ब्राउज़र फ़ाइलें शेयर कर सकता है
        if (navigator.share && navigator.canShare({ files: files })) {
          await navigator.share({
            title: 'Tile Designs',
            // text: '...'  <-- टेक्स्ट लाइन हटा दी गई
            files: files
          });
          shareBtn.innerHTML = '<i class="fab fa-whatsapp"></i> Share All';
          shareBtn.disabled = false;
        } else {
          throw new Error('File sharing not supported.');
        }
      } catch (error) {
        const shareBtn = document.querySelector('.cart-action-share');
        if(shareBtn) { 
            shareBtn.innerHTML = '<i class="fab fa-whatsapp"></i> Share All';
            shareBtn.disabled = false;
        }
        
        console.error('File share failed, falling back to text:', error);
        
        // 5. टेक्स्ट फॉलबैक का उपयोग करें
        if (navigator.share) { 
          navigator.share({ title: 'Tile Designs', text: textFallback });
        } else { 
          window.open(`https://wa.me/?text=${encodeURIComponent(textFallback)}`, '_blank');
        }
      }
    }
    // --- [नया] END CART LOGIC ---
    

    // PWA Install Logic
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      const installPrompt = document.getElementById('installPrompt');
      if (!localStorage.getItem('install-dismissed')) {
        setTimeout(() => {
          if(installPrompt) installPrompt.classList.add('show');
        }, 3000);
      }
    });
    
    // (बाकी मूल जावास्क्रिप्ट फंक्शन अपरिवर्तित)
    function getImageUrl(driveUrl) {
      const id = driveUrl?.match(/[-\w]{25,}/)?.[0];
      return id ? `https://drive.google.com/thumbnail?id=${id}&sz=w400` : '';
    }
    function getDownloadUrl(driveUrl) {
      const id = driveUrl?.match(/[-\w]{25,}/)?.[0];
      return id ? `https://drive.google.com/uc?export=download&id=${id}` : driveUrl;
    }
    function getFullImageUrl(driveUrl) {
      const id = driveUrl?.match(/[-\w]{25,}/)?.[0];
      return id ? `https://lh3.googleusercontent.com/d/${id}=w1200` : '';
    }
    function fuzzySearch(query, text) {
      query = query.toLowerCase();
      text = text.toLowerCase();
      let queryIndex = 0;
      for (let i = 0; i < text.length && queryIndex < query.length; i++) {
        if (text[i] === query[queryIndex]) queryIndex++;
      }
      return queryIndex === query.length;
    }
    function getSuggestions(query) {
      if (!query.trim()) return [];
      const selectedSize = app.elements.sizeFilter.value;
      let filteredBySize = app.data;
      if (selectedSize) {
        filteredBySize = app.data.filter(tile => tile.dimensions === selectedSize);
      }
      return filteredBySize
        .filter(tile => fuzzySearch(query, tile.design_name))
        .map(tile => tile.design_name)
        .filter((name, index, arr) => arr.indexOf(name) === index)
        .slice(0, 8);
    }
    function populateSizeFilter() {
      const sizes = [...new Set(app.data.map(t => t.dimensions))]
        .filter(Boolean)
        .sort((a, b) => {
          const aNum = parseInt(a.match(/\d+/)?.[0] || '0');
          const bNum = parseInt(b.match(/\d+/)?.[0] || '0');
          return aNum - bNum;
        });
      app.elements.sizeFilter.innerHTML = '<option value="">All Sizes</option>';
      sizes.forEach(size => {
        const opt = document.createElement('option');
        opt.value = size;
        opt.textContent = size;
        app.elements.sizeFilter.appendChild(opt);
      });
    }
    function showSuggestions(suggestions) {
      const container = app.elements.suggestions;
      if (!suggestions.length) {
        container.style.display = 'none';
        return;
      }
      container.innerHTML = suggestions
        .map(name => `<div class="suggestion-item" onclick="selectSuggestion('${name}')">${name}</div>`)
        .join('');
      container.style.display = 'block';
    }
    function selectSuggestion(name) {
      app.elements.searchInput.value = name;
      app.elements.suggestions.style.display = 'none';
      applyFilters();
    }

    // --- [बदलाव 9] संशोधित renderTiles फंक्शन ---
    function renderTiles() {
      const tilesToShow = app.filteredData.slice(0, app.displayedCount);
      
      if (!tilesToShow.length) {
        app.elements.tilesGrid.innerHTML = '';
        app.elements.loadMoreBtn.style.display = 'none';
        app.elements.emptyState.style.display = 'block';
        return;
      }

      app.elements.emptyState.style.display = 'none';
      
      app.elements.tilesGrid.innerHTML = tilesToShow.map(tile => {
        const imageUrl = getImageUrl(tile.url);
        const downloadUrl = getDownloadUrl(tile.url);
        const fullUrl = getFullImageUrl(tile.url);
        
        const isInCart = cart.some(item => item.design_name === tile.design_name);
        const btnIcon = isInCart ? '<i class="fas fa-check"></i>' : '<i class="fas fa-plus"></i>';
        const btnClass = isInCart ? 'action-btn select-btn selected' : 'action-btn select-btn';
        const cardClass = isInCart ? 'tile-card selected' : 'tile-card';

        return `
          <div class="${cardClass}" onclick="openModal('${tile.design_name}', '${tile.dimensions}', '${fullUrl}', '${downloadUrl}')">
            <div class="tile-image">
              ${imageUrl ? `<img src="${imageUrl}" alt="${tile.design_name}" loading="lazy" />` : 
                '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#8b949e">No Image</div>'}
            </div>
            <div class="tile-content">
              <div class="tile-info">
                <h3>${tile.design_name}</h3>
                <p>${tile.dimensions}</p>
              </div>
              <div class="tile-actions">
                <button class="${btnClass}" onclick="toggleSelection(event, '${tile.design_name}')" 
                        title="Select">
                  ${btnIcon}
                </button>
                <button class="action-btn download-btn" onclick="event.stopPropagation();window.open('${downloadUrl}','_blank')" 
                        title="Download"></button>
                <button class="action-btn whatsapp-btn" onclick="event.stopPropagation();shareToWhatsApp('${tile.design_name}','${fullUrl}')" 
                        title="Share on WhatsApp"></button>
              </div>
            </div>
          </div>`;
      }).join('');

      app.elements.loadMoreBtn.style.display = 
        app.displayedCount < app.filteredData.length ? 'block' : 'none';
    }
    // --- [संशोधित] END ---

    function applyFilters() {
      const searchTerm = app.elements.searchInput.value.toLowerCase().trim();
      const selectedSize = app.elements.sizeFilter.value;
      
      app.filteredData = app.data.filter(tile => {
        const matchesSearch = !searchTerm || tile.design_name.toLowerCase().includes(searchTerm);
        const matchesSize = !selectedSize || tile.dimensions === selectedSize;
        return matchesSearch && matchesSize;
      });
      
      app.displayedCount = 5;
      renderTiles();
    }

    function loadMore() {
      app.displayedCount += app.loadIncrement;
      renderTiles();
    }

    function openModal(title, size, imageUrl, downloadUrl) {
      app.elements.modalCaption.textContent = `${title} - ${size}`;
      app.elements.modalImage.src = imageUrl;
      
      app.elements.modalDownload.onclick = () => window.open(downloadUrl, '_blank');
      app.elements.modalWhatsapp.onclick = () => shareToWhatsApp(title, imageUrl);
      
      app.elements.modal.style.display = 'flex';
      document.body.classList.add('modal-open');
    }

    function closeModal() {
      app.elements.modal.style.display = 'none';
      document.body.classList.remove('modal-open');
    }

    // --- (यह आपका मूल एडवांस शेयर फंक्शन है) ---
    async function shareToWhatsApp(name, url) {
      try {
        const response = await fetch(url);
        const blob = await response.blob();
        const file = new File([blob], `${name}.jpg`, { type: 'image/jpeg' });
        
        if (navigator.share && navigator.canShare({ files: [file] })) {
          await navigator.share({ files: [file] });
        } else {
          window.open(`https://wa.me/?text=${encodeURIComponent(url)}`, '_blank');
        }
      } catch (error) {
        console.error('Share failed:', error);
        window.open(url, '_blank');
      }
    }
    
    async function loadData() {
      try {
        const csvUrl = 'https://docs.google.com/spreadsheets/d/1oHpJw-_zLdf_jt2SL5l7Hpiu8nSK9gvXfLEVvLlz5cM/export?format=csv&gid=622851011&_=' + Date.now();
        const response = await fetch(csvUrl);
        const text = await response.text();
        
        app.data = text.trim().split('\n').slice(1)
          .filter(line => line.trim())
          .map(line => {
            const cols = line.split(',');
            return {
              filename: cols[0] || '',
              dimensions: cols[1] || '',
              design_name: cols[2] || '',
              url: cols[3] || ''
            };
          })
          .filter(tile => tile.design_name && tile.url);

        app.filteredData = [...app.data];
        populateSizeFilter();
        renderTiles();
      } catch (error) {
        console.error('Failed to load data:', error);
        app.elements.emptyState.style.display = 'block';
        app.elements.emptyState.innerHTML = '<h3>Failed to load tiles</h3><p>Please check your connection and try again</p>';
      }
    }
    
    // --- [नया] ऐप को शुरू करने वाला फंक्शन ---
    function loadApp() {
        const installPromptEl = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const installDismiss = document.getElementById('installDismiss');

        if(installBtn) {
            installBtn.addEventListener('click', async () => {
              if (deferredPrompt) {
                deferredPrompt.prompt();
                await deferredPrompt.userChoice;
                deferredPrompt = null;
                installPromptEl.classList.remove('show');
              }
            });
        }
        
        if(installDismiss) {
            installDismiss.addEventListener('click', () => {
              installPromptEl.classList.remove('show');
              localStorage.setItem('install-dismissed', 'true');
            });
        }
        
        window.addEventListener('appinstalled', () => {
          if(installPromptEl) installPromptEl.classList.remove('show');
          console.log('PWA installed successfully');
        });

        app.elements.searchInput.addEventListener('input', (e) => {
          const query = e.target.value;
          if (query.length > 1) {
            const suggestions = getSuggestions(query);
            showSuggestions(suggestions);
          } else {
            app.elements.suggestions.style.display = 'none';
          }
          applyFilters();
        });

        app.elements.sizeFilter.addEventListener('change', () => {
          app.elements.searchInput.value = '';
          app.elements.suggestions.style.display = 'none';
          applyFilters();
        });

        app.elements.loadMoreBtn.addEventListener('click', loadMore);

        document.addEventListener('click', (e) => {
          if (!e.target.closest('.control-group')) {
            app.elements.suggestions.style.display = 'none';
          }
        });

        app.elements.modal.addEventListener('click', (e) => {
          if (e.target === app.elements.modal) closeModal();
        });
        
        // [बदलाव] कार्ट modal के लिए क्लिक हैंडलर
        document.getElementById('cartModalOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('cartModalOverlay')) closeCartModal();
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
              closeModal();
              closeCartModal();
          }
        });

        loadData();
    }
  </script>
  
  <nav class="bottom-nav">
    <a href="../index.html" class="nav-link">
        <i class="nav-icon fas fa-home"></i>
        <span>Home</span>
    </a>
    <a href="../project-price/index.html" class="nav-link">
        <i class="nav-icon fas fa-list-alt"></i>
        <span>Price List</span>
    </a>
    <a href="../project-calculator/index.html" class="nav-link">
        <i class="nav-icon fas fa-calculator"></i>
        <span>Calculator</span>
    </a>
    <a href="../project-tilesearch/index.html" class="nav-link active">
        <i class="nav-icon fas fa-search"></i>
        <span>Tiles</span>
    </a>
  </nav>
  </body>
</html>
